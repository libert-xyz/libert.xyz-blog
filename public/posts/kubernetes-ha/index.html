<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Highly Available Kubernetes Cluster Â· libert.xyz
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://www.youtube.com; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="Libert">
<meta name="description" content="

  HA Kubernetes
  
    
    Link to heading
  


One of the reasons for using Kubernetes in the first place is to have a high available, fully scalable application so the users can experience a smoothly interaction with the application.
Out of the box, Kubernetes and all the components are ready meant to be HA.
In this post, we are going to explore the best ways to achieve HA in Kubernetes.">
<meta name="keywords" content="blog,devops,libert,aws,python,linux,bash">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Highly Available Kubernetes Cluster">
  <meta name="twitter:description" content="HA Kubernetes Link to heading One of the reasons for using Kubernetes in the first place is to have a high available, fully scalable application so the users can experience a smoothly interaction with the application.
Out of the box, Kubernetes and all the components are ready meant to be HA. In this post, we are going to explore the best ways to achieve HA in Kubernetes.">

<meta property="og:url" content="http://localhost:1313/posts/kubernetes-ha/">
  <meta property="og:site_name" content="libert.xyz">
  <meta property="og:title" content="Highly Available Kubernetes Cluster">
  <meta property="og:description" content="HA Kubernetes Link to heading One of the reasons for using Kubernetes in the first place is to have a high available, fully scalable application so the users can experience a smoothly interaction with the application.
Out of the box, Kubernetes and all the components are ready meant to be HA. In this post, we are going to explore the best ways to achieve HA in Kubernetes.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-06-10T14:43:55-04:00">
    <meta property="article:modified_time" content="2019-06-10T14:43:55-04:00">
    <meta property="article:tag" content="Kubernetes">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-services-pt2/">
      <meta property="og:see_also" content="http://localhost:1313/posts/namespaces-quotas/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pods-qos/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pods-requests-limits/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-services/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-networking/">




<link rel="canonical" href="http://localhost:1313/posts/kubernetes-ha/">


<link rel="preload" href="http://localhost:1313/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="http://localhost:1313/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="http://localhost:1313/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="http://localhost:1313/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="http://localhost:1313/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:1313/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/images/apple-touch-icon.png">

<link rel="manifest" href="http://localhost:1313/site.webmanifest">
<link rel="mask-icon" href="http://localhost:1313/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      libert.xyz
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/open-source/">Open Source Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/kubernetes-ha/">
              Highly Available Kubernetes Cluster
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2019-06-10T14:43:55-04:00">
                June 10, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              2-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="http://localhost:1313/tags/kubernetes/">Kubernetes</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <hr>
<h3 id="ha-kubernetes">
  HA Kubernetes
  <a class="heading-link" href="#ha-kubernetes">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><img src="http://localhost:1313/images/ha-1.png" alt="targets"></p>
<p>One of the reasons for using Kubernetes in the first place is to have a high available, fully scalable application so the users can experience a smoothly interaction with the application.</p>
<p>Out of the box, <em>Kubernetes</em> and all the components are ready meant to be HA.
In this post, we are going to explore the best ways to achieve HA in Kubernetes.</p>
<h4 id="making-your-apps-highly-available">
  Making your apps Highly Available
  <a class="heading-link" href="#making-your-apps-highly-available">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>Making your apps HA is simple when using <em>Kubernetes</em>.
<em>Kubernetes</em> takes care of almost everything, but still, there is the risk of
the servers running <em>Kubernetes</em> going down.</p>
<h4 id="making-kubernetes-master-ha">
  Making Kubernetes Master HA
  <a class="heading-link" href="#making-kubernetes-master-ha">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>The way to have an HA cluster is obvious, having multiple servers running the Control Plane components.</p>
<ul>
<li><em>etcd</em></li>
<li><em>API Server</em></li>
<li><em>Controller Manager</em></li>
<li><em>Scheduler</em></li>
</ul>
<p><img src="http://localhost:1313/images/ha-2.png" alt="targets"></p>
<h4 id="ha-etcd">
  HA etcd
  <a class="heading-link" href="#ha-etcd">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p><em>etcd</em> is a distributed system by default. All we need to do is to run the appropriate number of machines and make them aware of each other.
The number of machines has to be an odd number (three, five or seven).</p>
<p>The odd number of nodes is because, of the <em>quorum</em>. For a cluster of <em>N</em> machines, the <em>quorum</em> is <code>(n/2)+1</code>. For an <em>odd-number</em> cluster, adding one node will always increase the number of nodes necessary for a <em>quorum</em>.
Then, having an even number of machines makes the fault tolerance worse since exactly the same number of nodes may fail without losing quorum but there are more nodes that can fail.</p>
<p>For a better insight check the <a href="https://raft.github.io/"  class="external-link" target="_blank" rel="noopener">Raft Consensus Algorithm</a>.</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Machines</th>
          <th style="text-align: center">Quorum</th>
          <th style="text-align: center">Fault Tolerance</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">1</td>
          <td style="text-align: center">1</td>
          <td style="text-align: center">0</td>
      </tr>
      <tr>
          <td style="text-align: center">2</td>
          <td style="text-align: center">2</td>
          <td style="text-align: center">0</td>
      </tr>
      <tr>
          <td style="text-align: center">3</td>
          <td style="text-align: center">2</td>
          <td style="text-align: center">1</td>
      </tr>
      <tr>
          <td style="text-align: center">4</td>
          <td style="text-align: center">3</td>
          <td style="text-align: center">1</td>
      </tr>
      <tr>
          <td style="text-align: center">5</td>
          <td style="text-align: center">3</td>
          <td style="text-align: center">2</td>
      </tr>
      <tr>
          <td style="text-align: center">6</td>
          <td style="text-align: center">4</td>
          <td style="text-align: center">2</td>
      </tr>
      <tr>
          <td style="text-align: center">7</td>
          <td style="text-align: center">4</td>
          <td style="text-align: center">3</td>
      </tr>
  </tbody>
</table>
<p>Having more than seven machines running <em>etcd</em> impacts performance.</p>
<h4 id="ha-api-server">
  HA API Server
  <a class="heading-link" href="#ha-api-server">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>The <em>API Server</em> is <em>stateless</em> (all data stored in etcd), just by adding more nodes to the <em>API Server</em> we can achieve High Availability. To make things simpler they don&rsquo;t need to be aware of each other.
By having multiple <em>API Servers</em> we need to have a load balancer in front of them, in this case, the other components like the <em>kubelet</em> communicates directly to the load balancer endpoint.</p>
<h4 id="ha-controllers--scheduler">
  HA Controllers &amp; Scheduler
  <a class="heading-link" href="#ha-controllers--scheduler">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>This is harder than HA <em>API Server</em> because these controllers continuously watch the cluster state and act when it changes, possibly modifying the cluster state. We don&rsquo;t want multiple or unintended modifications to the state of the cluster.
This is solved by choosing a <em>leader</em>  and <em>stand-by</em> solution.</p>
<p><img src="http://localhost:1313/images/ha-3.png" alt="targets"></p>
<hr>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="see-also-in-kubernetes">
        See also in kubernetes
        <a class="heading-link" href="#see-also-in-kubernetes">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="http://localhost:1313/posts/pod-services-pt2/">Kubernetes Services insights Pt2</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/namespaces-quotas/">Namespaces resources quotas</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pods-qos/">PODS QoS</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pods-requests-limits/">PODS Requests &amp; Limits</a>
            </li>
          
        
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pod-services/">Kubernetes Services insights</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
        
        
        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

  </main>

  

  
  
  <script src="http://localhost:1313/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
