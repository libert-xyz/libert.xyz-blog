<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Diving deeper into pod networking · libert.xyz
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://www.youtube.com; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="Libert">
<meta name="description" content="

  Inter-pod networking
  
    
    Link to heading
  

Networking is one of the most complex pieces in Kubernetes, let&rsquo;s try to summarize pod networking and apply the divide and conquer paradigm.

Each pod gets its own unique IP address.
Each pod can communicate with all other pods through a flat, NATless network.


  How Kubernetes does it?
  
    
    Link to heading
  

The networking is set up by the System Administrator or by a Container Network Interace (CNI) plugin.">
<meta name="keywords" content="blog,devops,libert,aws,python,linux,bash">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Diving deeper into pod networking">
  <meta name="twitter:description" content="Inter-pod networking Link to heading Networking is one of the most complex pieces in Kubernetes, let’s try to summarize pod networking and apply the divide and conquer paradigm.
Each pod gets its own unique IP address. Each pod can communicate with all other pods through a flat, NATless network. How Kubernetes does it? Link to heading The networking is set up by the System Administrator or by a Container Network Interace (CNI) plugin.">

<meta property="og:url" content="http://localhost:1313/posts/pod-networking/">
  <meta property="og:site_name" content="libert.xyz">
  <meta property="og:title" content="Diving deeper into pod networking">
  <meta property="og:description" content="Inter-pod networking Link to heading Networking is one of the most complex pieces in Kubernetes, let’s try to summarize pod networking and apply the divide and conquer paradigm.
Each pod gets its own unique IP address. Each pod can communicate with all other pods through a flat, NATless network. How Kubernetes does it? Link to heading The networking is set up by the System Administrator or by a Container Network Interace (CNI) plugin.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-06-02T15:37:05-04:00">
    <meta property="article:modified_time" content="2019-06-02T15:37:05-04:00">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Networking">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-services-pt2/">
      <meta property="og:see_also" content="http://localhost:1313/posts/namespaces-quotas/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pods-qos/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pods-requests-limits/">
      <meta property="og:see_also" content="http://localhost:1313/posts/kubernetes-ha/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-services/">




<link rel="canonical" href="http://localhost:1313/posts/pod-networking/">


<link rel="preload" href="http://localhost:1313/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="http://localhost:1313/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="http://localhost:1313/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="http://localhost:1313/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="http://localhost:1313/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:1313/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/images/apple-touch-icon.png">

<link rel="manifest" href="http://localhost:1313/site.webmanifest">
<link rel="mask-icon" href="http://localhost:1313/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      libert.xyz
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/open-source/">Open Source Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/pod-networking/">
              Diving deeper into pod networking
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2019-06-02T15:37:05-04:00">
                June 2, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              2-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="http://localhost:1313/tags/kubernetes/">Kubernetes</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="http://localhost:1313/tags/docker/">Docker</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="http://localhost:1313/tags/networking/">Networking</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <hr>
<h2 id="inter-pod-networking">
  Inter-pod networking
  <a class="heading-link" href="#inter-pod-networking">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Networking is one of the most complex pieces in Kubernetes, let&rsquo;s try to summarize pod networking and apply the divide and conquer paradigm.</p>
<ol>
<li>Each pod gets its own unique IP address.</li>
<li>Each pod can communicate with all other pods through a flat, NATless network.</li>
</ol>
<h3 id="how-kubernetes-does-it">
  How Kubernetes does it?
  <a class="heading-link" href="#how-kubernetes-does-it">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The networking is set up by the System Administrator or by a <em>Container Network Interace (CNI)</em> plugin.</p>
<p>Anyone can develop their own <em>CNI</em> plugin, the only conditions are the ones listed above.</p>
<h3 id="no-nat">
  No NAT
  <a class="heading-link" href="#no-nat">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><img src="http://localhost:1313/images/k8-net-1.png" alt="targets"></p>
<p>In the image above <em>pod A</em> sends a network package to <em>pod B</em>, the package sent by <em>pod A</em> must reach <em>pod B</em> with source and destination address unchanged.</p>
<p>By doing this, applications running in <em>pods</em> think that they are connected in the same plain network connected to the same network switch.</p>
<p>The only case when the <em>pod</em> source ip is changed is when it communicates with services on the internet, in this case, the source IP is changed to the host worker node IP address.</p>
<h3 id="even-deeper-into-networking">
  Even deeper into networking
  <a class="heading-link" href="#even-deeper-into-networking">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<h4 id="1-communication-between-containers-in-the-same-node">
  1. Communication between containers in the same node
  <a class="heading-link" href="#1-communication-between-containers-in-the-same-node">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>The network namespace is set up by the <em>Infrastructure Container (pause container)</em> .</p>
<p>Pods on a node are connected to the same bridge through virtual Ethernet interfaces.
If you run <code>ifconfig</code> in a node you will see a <code>vethxxx</code> listed.
The interface in the container namespace is renamed to <code>eth0</code></p>
<p><img src="http://localhost:1313/images/k8-net-2.png" alt="targets"></p>
<ol>
<li>The interface in the host&rsquo;s network namespace is attached to a networking bridge.</li>
<li>the <em>eth0</em> interface in the container is assigned an IP from the bridge IP range.</li>
<li>All containers in a node are connected to the same bridge.</li>
</ol>
<h4 id="2-communication-between-containers-in-different-nodes">
  2. Communication between containers in different nodes
  <a class="heading-link" href="#2-communication-between-containers-in-different-nodes">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>To enable communication between containers in different nodes, the birdges on those nodes need to be connected.</p>
<p>The node physical network needs to be connected with the virtual bridge as well.</p>
<p>Routing tables on node A need to be added to all packets destined for <code>10.1.2.0/24</code> are routed to node B, and node B routing tables need to be added so packets sent to <code>10.1.1.0/24</code> are routed to node A.</p>
<p><img src="http://localhost:1313/images/k8-net-3.png" alt="targets"></p>
<hr>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="see-also-in-kubernetes">
        See also in kubernetes
        <a class="heading-link" href="#see-also-in-kubernetes">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="http://localhost:1313/posts/pod-services-pt2/">Kubernetes Services insights Pt2</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/namespaces-quotas/">Namespaces resources quotas</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pods-qos/">PODS QoS</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pods-requests-limits/">PODS Requests &amp; Limits</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/kubernetes-ha/">Highly Available Kubernetes Cluster</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pod-services/">Kubernetes Services insights</a>
            </li>
          
        
        </ul>
      </nav>
    
  
    
    
    
  
</section>


        
        
        
        
        
        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

  </main>

  

  
  
  <script src="http://localhost:1313/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
