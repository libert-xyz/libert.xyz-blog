<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Service accounts &amp; RBAC Authorization · libert.xyz
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://www.youtube.com; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="Libert">
<meta name="description" content="
When a request is received by the API Server (kubectl) it goes through a list of
authentication plugins.
The plugins examine the request and determine who is sending the request.
An authentication plugin returns the username and group of the authenticated
user. Kubernetes doesn’t store that information anywhere; it uses it to verify whether
the user is authorized to perform an action or not.

  Users
  
    
    Link to heading
  

Kind of clients connecting the API Server:">
<meta name="keywords" content="blog,devops,libert,aws,python,linux,bash">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Service accounts & RBAC Authorization">
  <meta name="twitter:description" content="When a request is received by the API Server (kubectl) it goes through a list of authentication plugins. The plugins examine the request and determine who is sending the request.
An authentication plugin returns the username and group of the authenticated user. Kubernetes doesn’t store that information anywhere; it uses it to verify whether the user is authorized to perform an action or not.
Users Link to heading Kind of clients connecting the API Server:">

<meta property="og:url" content="http://localhost:1313/posts/rbac-authorization/">
  <meta property="og:site_name" content="libert.xyz">
  <meta property="og:title" content="Service accounts & RBAC Authorization">
  <meta property="og:description" content="When a request is received by the API Server (kubectl) it goes through a list of authentication plugins. The plugins examine the request and determine who is sending the request.
An authentication plugin returns the username and group of the authenticated user. Kubernetes doesn’t store that information anywhere; it uses it to verify whether the user is authorized to perform an action or not.
Users Link to heading Kind of clients connecting the API Server:">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-04-13T15:25:21-04:00">
    <meta property="article:modified_time" content="2019-04-13T15:25:21-04:00">
    <meta property="article:tag" content="Kubernetes">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-services-pt2/">
      <meta property="og:see_also" content="http://localhost:1313/posts/namespaces-quotas/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pods-qos/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pods-requests-limits/">
      <meta property="og:see_also" content="http://localhost:1313/posts/kubernetes-ha/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-services/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-networking/">




<link rel="canonical" href="http://localhost:1313/posts/rbac-authorization/">


<link rel="preload" href="http://localhost:1313/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="http://localhost:1313/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="http://localhost:1313/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="http://localhost:1313/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="http://localhost:1313/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:1313/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/images/apple-touch-icon.png">

<link rel="manifest" href="http://localhost:1313/site.webmanifest">
<link rel="mask-icon" href="http://localhost:1313/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      libert.xyz
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/open-source/">Open Source Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/rbac-authorization/">
              Service accounts &amp; RBAC Authorization
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2019-04-13T15:25:21-04:00">
                April 13, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              2-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="http://localhost:1313/tags/kubernetes/">Kubernetes</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <hr>
<p>When a request is received by the <em>API Server</em> (kubectl) it goes through a list of
authentication plugins.
The plugins examine the request and determine who is sending the request.</p>
<p>An authentication plugin returns the username and group of the authenticated
user. Kubernetes doesn’t store that information anywhere; it uses it to verify whether
the user is authorized to perform an action or not.</p>
<h3 id="users">
  Users
  <a class="heading-link" href="#users">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Kind of clients connecting the <em>API Server</em>:</p>
<ul>
<li>Humans (users)</li>
<li>Pods (applications running in them)</li>
</ul>
<h3 id="groups">
  Groups
  <a class="heading-link" href="#groups">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Human and <em>ServiceAccounts</em> can belong to multiple groups.</p>
<h3 id="serviceaccounts">
  ServiceAccounts
  <a class="heading-link" href="#serviceaccounts">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Every <em>POD</em> is associated with a <em>ServiceAccount</em> which represents the identity of the application running in the <em>POD</em>.</p>
<p>A <em>POD</em> authenticates with the <em>API Server</em> by sending the file <code>var/run/secrets/kubernetes.io/serviceaccount/token</code>, which is mounted in into each container file system through a secret volume.</p>
<p><em>ServiceAccount</em> usernames are formatted like this:</p>
<p><code>system:serviceaccount:&lt;namespace&gt;:&lt;service account name&gt;</code></p>
<h3 id="serviceaccount-resource">
  ServiceAccount resource
  <a class="heading-link" href="#serviceaccount-resource">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><em>ServiceAccount</em> is yet another object in Kubernetes like Pods, ConfigMaps and so on, is also associated with namespaces.</p>
<p>Each pod is associated with a single ServiceAccount in the pod’s namespace.</p>
<p><img src="http://localhost:1313/images/ser1.png" alt="targets"></p>
<h3 id="create-service-serviceaccounts">
  Create service ServiceAccounts
  <a class="heading-link" href="#create-service-serviceaccounts">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl create serviceaccount foo
</span></span></code></pre></div><p><img src="http://localhost:1313/images/ser2.png" alt="targets"></p>
<p>A custom token Secret has been created and associated with the
ServiceAccount.
The authentication tokens used in ServiceAccounts are JWT (JSON Web Tokens)</p>
<h3 id="rbac-authorization-plugin">
  RBAC Authorization plugin
  <a class="heading-link" href="#rbac-authorization-plugin">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>RBAC determines if a user may perform an action or not.
The API server exposes a REST interface, users perform actions by sending HTTP
requests to the server. Users authenticate themselves by including credentials in the request (authentication token, username and password, or a client certificate).</p>
<table>
  <thead>
      <tr>
          <th>HTTP Method</th>
          <th>Single Resource</th>
          <th>Multiple Resources</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>GET</td>
          <td>get (watch)</td>
          <td>list (and watch)</td>
      </tr>
      <tr>
          <td>POST</td>
          <td>create</td>
          <td>n/a</td>
      </tr>
      <tr>
          <td>PUT</td>
          <td>update</td>
          <td>n/a</td>
      </tr>
      <tr>
          <td>PATCH</td>
          <td>patch</td>
          <td>n/a</td>
      </tr>
      <tr>
          <td>DELETE</td>
          <td>delete</td>
          <td>n/a</td>
      </tr>
  </tbody>
</table>
<h3 id="rbac-resources">
  RBAC Resources
  <a class="heading-link" href="#rbac-resources">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>Roles and ClusterRoles</li>
<li>RoleBindings and ClusterRoleBindings</li>
</ul>
<p>Roles define what can be done, while bindings define who can do it</p>
<p><img src="http://localhost:1313/images/ser3.png" alt="targets"></p>
<p>The difference between Role and a ClusterRole, or between a RoleBinding and a
ClusterRoleBinding, is that the Role and RoleBinding are namespaced resources,
whereas the ClusterRole and ClusterRoleBinding are cluster-level resources</p>
<p><img src="http://localhost:1313/images/ser4.png" alt="targets"></p>
<table>
  <thead>
      <tr>
          <th>For accessing</th>
          <th>Role type to use</th>
          <th>Binding type to use</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Cluster-level resources (Nodes, PersistentVolumes)</td>
          <td>ClusterRole</td>
          <td>ClusterRoleBinding</td>
      </tr>
      <tr>
          <td>Non-resource URLs (/api, /healthz)</td>
          <td>ClusterRole</td>
          <td>ClusterRoleBinding</td>
      </tr>
      <tr>
          <td>Namespaced resources in any namespace (and across all namespaces)</td>
          <td>ClusterRole</td>
          <td>ClusterRoleBinding</td>
      </tr>
      <tr>
          <td>Namespaced resources in a specific namespace (reusing the same ClusterRole in multiple namespaces)</td>
          <td>ClusterRole</td>
          <td>RoleBinding</td>
      </tr>
      <tr>
          <td>Namespaced resources in a specific namespace (Role must be defined in each namespace)</td>
          <td>Role</td>
          <td>RoleBinding</td>
      </tr>
  </tbody>
</table>
<p>Sources:</p>
<p><a href="https://www.manning.com/books/kubernetes-in-action"  class="external-link" target="_blank" rel="noopener">https://www.manning.com/books/kubernetes-in-action</a></p>
<hr>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="see-also-in-kubernetes">
        See also in kubernetes
        <a class="heading-link" href="#see-also-in-kubernetes">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="http://localhost:1313/posts/pod-services-pt2/">Kubernetes Services insights Pt2</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/namespaces-quotas/">Namespaces resources quotas</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pods-qos/">PODS QoS</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pods-requests-limits/">PODS Requests &amp; Limits</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/kubernetes-ha/">Highly Available Kubernetes Cluster</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pod-services/">Kubernetes Services insights</a>
            </li>
          
        
        </ul>
      </nav>
    
  
    
    
    
  
</section>


        
        
        
        
        
        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

  </main>

  

  
  
  <script src="http://localhost:1313/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
