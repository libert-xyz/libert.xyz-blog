<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Kubernetes Services insights Pt2 · libert.xyz
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://www.youtube.com; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="Libert (lih-BERT)">
<meta name="description" content="In the first part we discussed pods communication through Kubernetes services, all of this internally in the cluster, but what if we need to expose the service to the internet?

  Exposing services to the internet
  
    
    Link to heading
  

Node Port
The service type NodePort creates a  unique port in every node of the cluster and forwards the requests to the pods that are part of that service.">
<meta name="keywords" content="blog,devops,libert,aws,python,linux,bash">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Kubernetes Services insights Pt2">
  <meta name="twitter:description" content="In the first part we discussed pods communication through Kubernetes services, all of this internally in the cluster, but what if we need to expose the service to the internet?
Exposing services to the internet Link to heading Node Port
The service type NodePort creates a unique port in every node of the cluster and forwards the requests to the pods that are part of that service.">

<meta property="og:url" content="https://libert.xyz/posts/pod-services-pt2/">
  <meta property="og:site_name" content="libert.xyz">
  <meta property="og:title" content="Kubernetes Services insights Pt2">
  <meta property="og:description" content="In the first part we discussed pods communication through Kubernetes services, all of this internally in the cluster, but what if we need to expose the service to the internet?
Exposing services to the internet Link to heading Node Port
The service type NodePort creates a unique port in every node of the cluster and forwards the requests to the pods that are part of that service.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-04-09T13:23:38-04:00">
    <meta property="article:modified_time" content="2021-04-09T13:23:38-04:00">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Docker">
      <meta property="og:see_also" content="https://libert.xyz/posts/namespaces-quotas/">
      <meta property="og:see_also" content="https://libert.xyz/posts/pods-qos/">
      <meta property="og:see_also" content="https://libert.xyz/posts/pods-requests-limits/">
      <meta property="og:see_also" content="https://libert.xyz/posts/kubernetes-ha/">
      <meta property="og:see_also" content="https://libert.xyz/posts/pod-services/">
      <meta property="og:see_also" content="https://libert.xyz/posts/pod-networking/">
      <meta property="og:see_also" content="https://libert.xyz/posts/pod-services/">




<link rel="canonical" href="https://libert.xyz/posts/pod-services-pt2/">


<link rel="preload" href="https://libert.xyz/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://libert.xyz/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://libert.xyz/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="https://libert.xyz/css/coder.min.4b392a85107b91dbdabc528edf014a6ab1a30cd44cafcd5325c8efe796794fca.css" integrity="sha256-SzkqhRB7kdvavFKO3wFKarGjDNRMr81TJcjv55Z5T8o=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="https://libert.xyz/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="https://libert.xyz/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="https://libert.xyz/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://libert.xyz/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="https://libert.xyz/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://libert.xyz/images/apple-touch-icon.png">

<link rel="manifest" href="https://libert.xyz/site.webmanifest">
<link rel="mask-icon" href="https://libert.xyz/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://libert.xyz/">
      libert.xyz
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://libert.xyz/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://libert.xyz/open-source/">Open Source Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://libert.xyz/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://libert.xyz/posts/pod-services-pt2/">
              Kubernetes Services insights Pt2
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2021-04-09T13:23:38-04:00">
                April 9, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="https://libert.xyz/tags/kubernetes/">Kubernetes</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://libert.xyz/tags/docker/">Docker</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>In the first <a href="https://libert.xyz/posts/pod-services/"  class="external-link" target="_blank" rel="noopener">part</a> we discussed pods communication through Kubernetes services, all of this internally in the cluster, but what if we need to expose the service to the internet?</p>
<h3 id="exposing-services-to-the-internet">
  Exposing services to the internet
  <a class="heading-link" href="#exposing-services-to-the-internet">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Node Port</strong></p>
<p>The service type <code>NodePort</code> creates a  unique port in every node of the cluster and forwards the requests to the pods that are part of that service.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">example-nodeport</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort             ❶</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>                 <span style="color:#ae81ff">❷</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>           <span style="color:#ae81ff">❸</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30021</span>          <span style="color:#ae81ff">❹</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">example</span>
</span></span></code></pre></div><p>❶ Set the service type to NodePort.</p>
<p>❷ Port of the service’s internal cluster IP.</p>
<p>❸ Target port of the backing pods.</p>
<p>❹ The service will be accessible through port 30021 of each of your cluster node (no requiered, if missing Kubernetes will choose a random port)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl get service example-nodeport
</span></span><span style="display:flex;"><span>NAME               CLUSTER-IP       EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
</span></span><span style="display:flex;"><span>example-nodeport   10.110.254.212   &lt;nodes&gt;       80:30021/TCP   14m
</span></span></code></pre></div><p>Now you can access the service via the Node public IP address.
Let&rsquo;s assume that the public IP address of one of our nodes is <code>35.203.63.213</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://35.203.63.213:30021
</span></span><span style="display:flex;"><span>&lt;!DOCTYPE html&gt;
</span></span><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;head&gt;
</span></span><span style="display:flex;"><span>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span style="display:flex;"><span>&lt;/head&gt;
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p><strong>LoadBalancer</strong></p>
<p>The <code>LoadBalancer</code> service type is an extension of the <code>NodePort</code> type service.  Is only supported in Kubernetes clusters running in Cloud Service providers like AWS and GCP.</p>
<p>If the Kubernetes cluster does not support the <code>LoadBalancer</code> service type then a <code>NodePort</code> service will be created instead.</p>
<p><img src="https://libert.xyz/images/k8-servces-pt2-1.png" alt="elb" title="LoadBalancer"></p>
<p><strong>Ingress Resource</strong></p>
<p>The <code>Ingress</code> resource is a controller that runs in the cluster.
It operates at the layer 7 (application) level offering different options to route traffic to one or more services using a single endpoint.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">extensions/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">example</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">service.libert.xyz</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">http</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">example-nodeport</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">servicePort</span>: <span style="color:#ae81ff">80</span>
</span></span></code></pre></div><p>Now you can access the ingress using the hostname.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl http://service.libert.xyz
</span></span><span style="display:flex;"><span>&lt;!DOCTYPE html&gt;
</span></span><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;head&gt;
</span></span><span style="display:flex;"><span>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span style="display:flex;"><span>&lt;/head&gt;
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>The workflow starts with a DNS lookup of service.libert.xyz to getthe IP of the Ingress controller.</p>
<p>The client then sent an HTTP request to the <code>Ingress</code> controller and specified service.libert.xyz in the Host header.</p>
<p>From that header, the <code>Ingress</code> controller determines which service the client is trying to access, looked up the pod IPs through the Endpoints object associated with the service, and forwards the client’s request to one of the pods.</p>
<p>In the following example, we can see how we can route the traffic to different services using a single endpoint.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">service.libert.xyz</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">http</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/health                ❶</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">backend</span>:                     <span style="color:#ae81ff">❶</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">foo           ❶</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">servicePort</span>: <span style="color:#ae81ff">80</span>            <span style="color:#ae81ff">❶</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/bar                   ❷</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">backend</span>:                     <span style="color:#ae81ff">❷</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">bar           ❷</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">servicePort</span>: <span style="color:#ae81ff">80</span>            <span style="color:#ae81ff">❷</span>
</span></span></code></pre></div><hr>
<p>*** References - <a href="https://www.manning.com/books/kubernetes-in-action"  class="external-link" target="_blank" rel="noopener">Kubernetes in Action</a></p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="see-also-in-kubernetes">
        See also in kubernetes
        <a class="heading-link" href="#see-also-in-kubernetes">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="https://libert.xyz/posts/namespaces-quotas/">Namespaces resources quotas</a>
            </li>
          
        
          
            <li>
              <a href="https://libert.xyz/posts/pods-qos/">PODS QoS</a>
            </li>
          
        
          
            <li>
              <a href="https://libert.xyz/posts/pods-requests-limits/">PODS Requests &amp; Limits</a>
            </li>
          
        
          
            <li>
              <a href="https://libert.xyz/posts/kubernetes-ha/">Highly Available Kubernetes Cluster</a>
            </li>
          
        
          
            <li>
              <a href="https://libert.xyz/posts/pod-services/">Kubernetes Services insights</a>
            </li>
          
        
        </ul>
      </nav>
    
  
    
    
    
      <h3 id="see-also-in-services">
        See also in services
        <a class="heading-link" href="#see-also-in-services">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="https://libert.xyz/posts/pod-services/">Kubernetes Services insights</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
        
        
        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

  </main>

  

  
  
  <script src="https://libert.xyz/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
