<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Kubernetes Services insights · libert.xyz
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://www.youtube.com; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="Libert Schmidt">
<meta name="description" content="

  Services introduction
  
    
    Link to heading
  

A Kubernetes service provides a static endpoint (IP) to access pods.
The IP is static and never changes while the service exists.
Services can have multiple pods in different nodes, in every request the service routes the traffic to a random backed pod even if the request comes from the same client.

  Kubernetes Services
  
    
    Link to heading
  

The kube-proxy manages everything related to services.">
<meta name="keywords" content="blog,devops,libert,aws,python,linux,bash">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Kubernetes Services insights">
  <meta name="twitter:description" content="Services introduction Link to heading A Kubernetes service provides a static endpoint (IP) to access pods. The IP is static and never changes while the service exists. Services can have multiple pods in different nodes, in every request the service routes the traffic to a random backed pod even if the request comes from the same client.
Kubernetes Services Link to heading The kube-proxy manages everything related to services.">

<meta property="og:url" content="http://localhost:1313/posts/pod-services/">
  <meta property="og:site_name" content="libert.xyz">
  <meta property="og:title" content="Kubernetes Services insights">
  <meta property="og:description" content="Services introduction Link to heading A Kubernetes service provides a static endpoint (IP) to access pods. The IP is static and never changes while the service exists. Services can have multiple pods in different nodes, in every request the service routes the traffic to a random backed pod even if the request comes from the same client.
Kubernetes Services Link to heading The kube-proxy manages everything related to services.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-06-05T14:53:00-04:00">
    <meta property="article:modified_time" content="2021-04-08T14:53:00-04:00">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Docker">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-services-pt2/">
      <meta property="og:see_also" content="http://localhost:1313/posts/namespaces-quotas/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pods-qos/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pods-requests-limits/">
      <meta property="og:see_also" content="http://localhost:1313/posts/kubernetes-ha/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-networking/">
      <meta property="og:see_also" content="http://localhost:1313/posts/pod-services-pt2/">




<link rel="canonical" href="http://localhost:1313/posts/pod-services/">


<link rel="preload" href="http://localhost:1313/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="http://localhost:1313/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="http://localhost:1313/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="http://localhost:1313/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="http://localhost:1313/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:1313/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/images/apple-touch-icon.png">

<link rel="manifest" href="http://localhost:1313/site.webmanifest">
<link rel="mask-icon" href="http://localhost:1313/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      libert.xyz
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/open-source/">Open Source Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="http://localhost:1313/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/pod-services/">
              Kubernetes Services insights
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2019-06-05T14:53:00-04:00">
                June 5, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="http://localhost:1313/tags/kubernetes/">Kubernetes</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="http://localhost:1313/tags/docker/">Docker</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <hr>
<h2 id="services-introduction">
  Services introduction
  <a class="heading-link" href="#services-introduction">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>A Kubernetes service provides a static endpoint (IP) to access pods.
The IP is static and never changes while the service exists.
Services can have multiple pods in different nodes, in every request the service routes the traffic to a random backed pod even if the request comes from the same client.</p>
<h2 id="kubernetes-services">
  Kubernetes Services
  <a class="heading-link" href="#kubernetes-services">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The <em>kube-proxy</em> manages everything related to services.</p>
<p>In summary, a service has the following characteristics</p>
<ul>
<li>Each service gets its own stable IP address and port.</li>
<li>Clients and pods connect to the service ip address and port.</li>
<li>The IP address is virtual</li>
<li>The IP address in not assigned to any network interface and is not listed as source or destination IP address in a network packet when the packet leaves the node.</li>
<li>You can&rsquo;t ping the service IP.</li>
</ul>
<h3 id="kube-proxy-and-iptables">
  kube-proxy and iptables
  <a class="heading-link" href="#kube-proxy-and-iptables">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>When a service is created, <code>kubectl create -f sevice.yaml</code>, the following happens:</p>
<ul>
<li>The virtual IP is created.</li>
<li>The <em>API Server</em> notifies <em>kube-proxy</em> agents in each node that a new service has been created.</li>
<li><em>kube-proxy</em> creates iptables rules to route traffic from the virtual IP/port to the pods behind the service.</li>
</ul>
<p>In the following figure, we can see a pod try to reach another pod backing up by a service.</p>
<ol>
<li>The packet destination is initially set to the IP/port of the service (<code>172.30.0.1:80</code>)</li>
<li>The packet is handled by the <em>iptables</em> rules on the node.</li>
<li>The <em>iptables</em> rules check if there is any match.</li>
<li>One of the rules is: <em>if the packet destination equals to <code>172.30.0.1</code></em> and equals to port <code>80</code>, replace the IP/port destination with the IP/port of a pod (the target pod specified in the Service spec).</li>
<li>From here,  it’s exactly as if the client pod had sent the packet
to pod B directly instead of through the service.</li>
</ol>
<p><img src="https://libert.xyz/images/k8-services-1.png" alt="k8-services-1" title="Services/iptables"></p>
<h3 id="services-discovery">
  Services discovery
  <a class="heading-link" href="#services-discovery">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>How does a client or pod know what is the IP and port of a given service?</p>
<p><strong>Environment variables</strong></p>
<p>When a <em>pod</em> is first started Kubernetes creates a set of environment variables pointing to services that exist at the moment (if you create the service before the pods)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl exec pod-example env
</span></span><span style="display:flex;"><span>PATH<span style="color:#f92672">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</span></span><span style="display:flex;"><span>HOSTNAME<span style="color:#f92672">=</span>pod-example
</span></span><span style="display:flex;"><span>KUBERNETES_SERVICE_HOST<span style="color:#f92672">=</span>10.12.100.1
</span></span><span style="display:flex;"><span>KUBERNETES_SERVICE_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>EXAMPLE_SERVICE_HOST<span style="color:#f92672">=</span>10.12.100.16
</span></span><span style="display:flex;"><span>EXAMPLE_SERVICE_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>
</span></span></code></pre></div><p><strong>kube-dns</strong></p>
<p>Is a pod that runs a DNS server in the <em>kube-sytem</em> namespace. It configures a DNS entry (<strong>/etc/resolv.conf</strong>) on every pod launched in the cluster.</p>
<p>Each service gets an entry in the internal DNS server and the pods can access them by their Fully Qualified Domain Name (FQDN):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>service-example.default.svc.cluster.local
</span></span></code></pre></div><h3 id="services-endpoints">
  Services Endpoints
  <a class="heading-link" href="#services-endpoints">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>When a pod selector is defined in the service spec is not used when redirecting traffic from the service to the pods. Instead, the selector creates IPs and ports that are added to the <em>endpoint</em> resource.
When a client sends a request to the service, the service proxy selects one of the IPs and ports of the endpoint.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">$ kubectl describe svc example-service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Name</span>:                <span style="color:#ae81ff">example-service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Selector</span>:            <span style="color:#ae81ff">app=myApp</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Type</span>:                <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">IP</span>:                  <span style="color:#ae81ff">10.12.249.153</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Port</span>:                <span style="color:#ae81ff">&lt;unset&gt; 80/TCP</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Endpoints</span>:           <span style="color:#ae81ff">10.111.1.4</span>:<span style="color:#ae81ff">8080</span>,<span style="color:#ae81ff">10.111.2.5</span>:<span style="color:#ae81ff">8080</span>,<span style="color:#ae81ff">10.111.2.6</span>:<span style="color:#ae81ff">8080</span>
</span></span></code></pre></div><p>Notice that if you create a service without a pod selector no endpoints will be added to the service.</p>
<hr>
<p>*** References - <a href="https://www.manning.com/books/kubernetes-in-action"  class="external-link" target="_blank" rel="noopener">Kubernetes in Action</a></p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="see-also-in-kubernetes">
        See also in kubernetes
        <a class="heading-link" href="#see-also-in-kubernetes">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="http://localhost:1313/posts/pod-services-pt2/">Kubernetes Services insights Pt2</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/namespaces-quotas/">Namespaces resources quotas</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pods-qos/">PODS QoS</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/pods-requests-limits/">PODS Requests &amp; Limits</a>
            </li>
          
        
          
            <li>
              <a href="http://localhost:1313/posts/kubernetes-ha/">Highly Available Kubernetes Cluster</a>
            </li>
          
        
          
        
        </ul>
      </nav>
    
  
    
    
    
      <h3 id="see-also-in-services">
        See also in services
        <a class="heading-link" href="#see-also-in-services">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="http://localhost:1313/posts/pod-services-pt2/">Kubernetes Services insights Pt2</a>
            </li>
          
        
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
        
        
        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2025
     Libert Schmidt 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="http://localhost:1313/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
